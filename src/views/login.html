<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Materiales</title>
    <link rel="stylesheet" href="../assets/vendors/core/core.css" />
    <link
      rel="stylesheet"
      href="../assets/fonts/feather-font/css/iconfont.css"
    />
    <link rel="stylesheet" href="../assets/css/style.css" />
    <link rel="shortcut icon" href="../assets/images/favicon.png" />
  </head>

  <body>
    <div class="main-wrapper">
      <div class="page-wrapper full-page">
        <div
          class="page-content d-flex align-items-center justify-content-center"
        >
          <div class="row w-100 mx-0 auth-page">
            <div class="col-md-8 col-xl-6 mx-auto">
              <div class="card">
                <div class="row">
                  <div class="col-md-10 mx-auto">
                    <div class="auth-form-wrapper px-4 py-5">
                      <div class="noble-ui-logo d-block mb-2">
                        Iniciar Sesion
                      </div>
                      <h5
                        id="text-error"
                        class="text-muted font-weight-normal mb-4"
                      >
                        ¡Bienvenido Ingrese a su cuenta!
                      </h5>

                      <form
                        class="forms-login"
                        onsubmit="return formSubmit(event)"
                      >
                        <div id="error-message" class="error-message"></div>

                        <div class="form-group">
                          <label for="txtEmail">Correo electrónico</label>
                          <input
                            type="text"
                            class="form-control"
                            id="txtEmail"
                            placeholder="Correo electrónico"
                            required
                            autofocus
                          />
                        </div>
                        <div class="form-group">
                          <label for="txtPassword">Contraseña</label>
                          <input
                            type="password"
                            class="form-control"
                            id="txtPassword"
                            autocomplete="current-password"
                            placeholder="Contraseña"
                            required
                          />
                        </div>
                        <div class="mt-3">
                          <button
                            id="btnLogin"
                            type="submit"
                            class="btn btn-primary mr-2 mb-2 mb-md-0 text-white"
                          >
                            Inicia Sesión
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      async function formSubmit(event) {
        console.log("klfgdkldfgkl");
        event.preventDefault();

        // Get values from the email and password fields
        var emailInput = document.getElementById("txtEmail");
        var passwordInput = document.getElementById("txtPassword");

        var emailValue = emailInput.value;
        var passwordValue = passwordInput.value;
        if (!emailValue.trim() || !passwordValue.trim()) {
          alert("Por favor, completa todos los campos.");
          return;
        }

        try {
          let data = {
            clave: passwordValue,
            nombre: emailValue,
          };
          emailInput.disabled = true;
          passwordInput.disabled = true;

          const response = await axios.post(
            "https://pedidosventas.materialessoto.com/login/",
            data,
            {
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
              },
            }
          );

          if (response?.data?.status === 200) {
            // Redireccionar a la página de inicio
            window.location.href = "index.html";
          } else {
            // Mostrar mensaje de error
            // alert("Credenciales incorrectas. Por favor, inténtalo de nuevo.");
            showError(
              "Ocurrió un error. Por favor, inténtalo de nuevo.",
              60000
            );
          }
        } catch (error) {
          console.log(error);
          // Puedes manejar otros errores aquí según tus necesidades
          alert("Ocurrió un error. Por favor, inténtalo de nuevo.");
        } finally {
          // Siempre habilitar los campos, incluso si hay un error
          emailInput.disabled = false;
          passwordInput.disabled = false;
        }
      }

      function showError(message, duration) {
        var errorMessage = document.getElementById("error-message");
        errorMessage.innerHTML = message;
        errorMessage.style.display = "block";

        // Ocultar el mensaje después del tiempo especificado
        setTimeout(() => {
          errorMessage.style.display = "none";
        }, duration);
      }
    </script>

    <script src="../assets/vendors/core/core.js"></script>

    <script src="../assets/vendors/promise-polyfill/polyfill.min.js"></script>

    <script src="../assets/vendors/feather-icons/feather.min.js"></script>
    <script src="../assets/js/template.js"></script>
  </body>
</html>